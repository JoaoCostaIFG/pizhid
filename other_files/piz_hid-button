#!/usr/bin/env python3

import RPi.GPIO as GPIO
from subprocess import call
from time import sleep


def shutdown(channel):
    call(["piz_hid-blink"])
    call(["sudo", "shutdown", "now"])


def wlanToggle(channel):
    call(["toggle_wlan"])
    call(["piz_hid-blink"])


# constants
bounce_time = 300

# don't use physical pin numbering
GPIO.setmode(GPIO.BCM)
# shutdown button
GPIO.setup(3, GPIO.IN, pull_up_down=GPIO.PUD_UP)
GPIO.add_event_detect(3, GPIO.RISING, callback=shutdown, bouncetime=bounce_time)
# other button
GPIO.setup(21, GPIO.IN, pull_up_down=GPIO.PUD_UP)
GPIO.add_event_detect(21, GPIO.RISING, callback=wlanToggle, bouncetime=bounce_time)

while True:
    sleep(3600)

GPIO.cleanup()  # Clean up
